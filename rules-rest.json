{
    "rules": [
        {
            "name": "Set brandhouse icons from venueType",
            "filter": [
                "all",
                ["!", ["get", "iconUrl"]],
                ["any", ["==", ["get", "venueType"], "brandhouse-t"], ["==", ["get", "venueType"], "brandhouse"]]
            ],
            "update": [
                {
                    "iconUrlBase": ["concat", "https://fest-digitalx.expofp.com/images/new/", ["get", "venueType"]]
                },
                {
                    "iconUrlActive": ["concat", ["get", "iconUrlBase"], "-active.png"],
                    "iconUrl": ["concat", ["get", "iconUrlBase"], ".png"]
                },
                {
                    "iconUrlBase": ["undefined"]
                }
            ]
        },
        {
            "name": "Set route icons",
            "filter": ["all", ["!", ["get", "iconUrl"]], ["==", ["get", "venueType"], "bus_route"]],
            "update": [
                {
                    "iconUrlBase": "https://fest-digitalx.expofp.com/images/new/route"
                },
                {
                    "iconUrlActive": ["concat", ["get", "iconUrlBase"], "-active.png"],
                    "iconUrl": ["concat", ["get", "iconUrlBase"], ".png"]
                },
                {
                    "iconUrlBase": ["undefined"]
                }
            ]
        },
        {
            "name": "Set tour icons",
            "filter": ["all", ["!", ["get", "iconUrl"]], ["==", ["get", "venueType"], "tour"]],
            "update": [
                {
                    "iconUrlBase": "https://fest-digitalx.expofp.com/images/new/tour"
                },
                {
                    "iconUrlActive": ["concat", ["get", "iconUrlBase"], "-active.png"],
                    "iconUrl": ["concat", ["get", "iconUrlBase"], ".png"]
                },
                {
                    "iconUrlBase": ["undefined"]
                }
            ]
        },
        {
            "name": "Set icons from venueType/sector",
            "filter": ["all", ["!", ["get", "iconUrl"]], ["get", "venueType"], ["get", "sector"]],
            "update": [
                {
                    "iconUrlBase": [
                        "concat",
                        "https://fest-digitalx.expofp.com/images/new/",
                        ["get", "venueType"],
                        "-",
                        ["get", "sector"]
                    ]
                },
                {
                    "iconUrlActive": ["concat", ["get", "iconUrlBase"], "-active.png"],
                    "iconUrl": ["concat", ["get", "iconUrlBase"], ".png"]
                },
                {
                    "iconUrlBase": ["undefined"]
                }
            ]
        },

        {
            "name": "Set default iconUrl for all entities",
            "filter": ["!", ["get", "iconUrl"]],
            "update": {
                "iconUrl": "https://fest-digitalx.expofp.com/images/new/default.png",
                "iconUrlActive": "https://fest-digitalx.expofp.com/images/new/default-active.png"
            }
        },
        {
            "name": "Make exhibitors select venue and have geometry copied from venue",
            "filter": ["all", ["==", "Exhibitor", ["get", "entityType"], ["!", ["get", "geometry"]]]],
            "update": {
                "select": ["create-array", ["get", "parent"], ["id"]],
                "geometry": ["get", "geometry", ["get", "parentVenue"]]
            }
        },
        {
            "name": "Set parent routes field",
            "update": [
                {
                    "tmpParentRoutes": [
                        "map",
                        ["filter", ["parents"], "e", null, ["==", ["get", "entityType", ["var", "e"]], "Route"]],
                        "val",
                        null,
                        ["id", ["var", "val"]]
                    ]
                },
                {
                    "tmpMeAndRoutes": ["flattern", ["get", "tmpParentRoutes"], ["create-array", ["id"]]]
                }
            ]
        },
        {
            "name": "Make everyone having route also select it, but not zoom to it",
            "filter": ["length", ["get", "tmpParentRoutes"]],
            "update": {
                "select": ["get", "tmpMeAndRoutes"],
                "zoom": ["id"]
            }
        },
        {
            "name": "Make route also select items on route",
            "filter": ["==", "Route", ["get", "entityType"]],
            "update": [
                {
                    "select": [
                        "flattern",
                        ["map", ["children"], "val", null, ["id", ["var", "val"]]],
                        ["create-array", ["id"]]
                    ]
                }
            ]
        },
        {
            "name": "Cleanup",
            "update": {
                "tmpParentRoutes": ["undefined"],
                "tmpMeAndRoutes": ["undefined"],
                "parentVenue": ["undefined"]
            }
        }
    ]
}
